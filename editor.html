<!DOCTYPE html>
<html>
<head>
  <title>Editor</title>
  <style>
    /* ... your styles ... */
    #link-input {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Editor</h2>
    <input type="text" id="link-input" placeholder="Paste Google Drive link">
    <button onclick="addLink()">Add Link</button>
    <div id="links-display"></div>
    <button onclick="showInput()">Add Link</button>
    <button onclick="doneAdding()">Done</button>
  </div>

  <script>
    const linkInput = document.getElementById('link-input');
    const linksDisplay = document.getElementById('links-display');
    let links = [];

    window.addEventListener('DOMContentLoaded', () => {
      fetchLinks();
    });

    function fetchLinks() {
      fetch('/data.json') // Assumes data.json is in the root directory
        .then(response => response.json())
        .then(data => {
          links = data;
          displayLinks();
        });
    }

    function displayLinks() {
      linksDisplay.innerHTML = '';
      links.forEach(linkObj => {
        const linkContainer = document.createElement('div');
        linkContainer.className = 'link-container';
        linkContainer.textContent = linkObj.link;
        linksDisplay.appendChild(linkContainer);
      });
    }

    function showInput() {
      linkInput.style.display = 'block';
    }

    function addLink() {
      const link = linkInput.value;

      fetch('/.netlify/functions/update-links', { // Correct Netlify Function URL
        method: 'POST',
        body: JSON.stringify({ link: link })
      })
        .then(response => response.json())
        .then(newLink => {
          links.push(newLink);
          displayLinks();
          // Notify the customer page about the new link (using BroadcastChannel)
          const broadcast = new BroadcastChannel('newLink');
          broadcast.postMessage(newLink);

          linkInput.value = '';
          linkInput.style.display = 'none';
        })
        .catch(error => console.error("Error adding link:", error));
    }

    function doneAdding() {
      window.location.href = "editor.html"; // Redirect to editor's homepage
    }
  </script>
</body>
</html>