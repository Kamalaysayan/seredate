<!DOCTYPE html>
<html>
<head>
  <title>Editor</title>
  <style>
    #link-input {
      display: none;
    }
    .pink-container {
      background-color: pink;
      padding: 10px;
      margin: 5px;
      display: inline-block;
      cursor: pointer;
    }
    #done-button {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Editor</h2>
    <input type="text" id="link-input" placeholder="Paste Google Drive link">
    <button onclick="showInput()">Add Link</button>
    <div id="links-display"></div>
    <button id="done-button" onclick="doneAdding()">Done</button>
  </div>

  <script>
    const linkInput = document.getElementById('link-input');
    const linksDisplay = document.getElementById('links-display');
    const doneButton = document.getElementById('done-button');
    let links = [];

    window.addEventListener('DOMContentLoaded', () => {
        fetchLinks();
    });

    function fetchLinks() {
        fetch('/data.json')
            .then(response => response.json())
            .then(data => {
                links = data;
                displayLinks();
            });
    }

    function displayLinks() {
        linksDisplay.innerHTML = ''; // Clear previous links

        // Iterate through the links and create containers
        links.forEach((linkObj, index) => {
            const linkContainer = document.createElement('div');
            linkContainer.className = 'pink-container';
            linkContainer.textContent = linkObj.link; // Display the actual link
            linksDisplay.appendChild(linkContainer);
        });

        // Show "Done" button only if there are links
        doneButton.style.display = links.length > 0 ? 'block' : 'none';
    }

    function showInput() {
        linkInput.style.display = 'block';
    }

    function addLink() {
        const link = linkInput.value;

        fetch('/.netlify/functions/update-links', {
            method: 'POST',
            body: JSON.stringify({ link: link })
        })
            .then(response => response.json())
            .then(newLink => {
                links.push(newLink);
                displayLinks(); // Update the display immediately
                const broadcast = new BroadcastChannel('newLink');
                broadcast.postMessage(newLink);
                linkInput.value = '';
                linkInput.style.display = 'none';
            })
            .catch(error => console.error("Error adding link:", error));
    }

    function doneAdding() {
        fetchLinks(); // Refresh links to update display
    }
  </script>
</body>
</html>