<!DOCTYPE html>
<html>
<head>
  <title>Editor</title>
  <style>
    /* ... your styles ... */
    #link-input {
      display: none;
    }
    .pink-container { /* Basic styling for the containers */
      background-color: pink;
      padding: 10px;
      margin: 5px;
      display: inline-block;
      cursor: pointer; /* Make them clickable */
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Editor</h2>
    <input type="text" id="link-input" placeholder="Paste Google Drive link">
    <button onclick="addLink()">Add Link</button>
    <div id="links-display"></div>
    <button onclick="showInput()">Add Link</button>
    <button onclick="doneAdding()">Done</button>
  </div>

  <script>
    const linkInput = document.getElementById('link-input');
    const linksDisplay = document.getElementById('links-display');
    let links = [];

    window.addEventListener('DOMContentLoaded', () => {
      fetchLinks();
    });

    function fetchLinks() {
      fetch('/data.json')
        .then(response => response.json())
        .then(data => {
          links = data;
          displayLinks();
        });
    }

    function displayLinks() {
      linksDisplay.innerHTML = ''; // Clear previous links
      links.forEach((linkObj, index) => {
        const linkContainer = document.createElement('div');
        linkContainer.className = 'pink-container';
        linkContainer.textContent = linkObj.link || (index + 1); // Display link or number
        linksDisplay.appendChild(linkContainer);
      });
    }

    function showInput() {
      linkInput.style.display = 'block';
    }

    function addLink() {
      const link = linkInput.value;

      fetch('/.netlify/functions/update-links', {
        method: 'POST',
        body: JSON.stringify({ link: link })
      })
        .then(response => response.json())
        .then(newLink => {
          links.push(newLink);
          displayLinks(); // Update the display on the editor's page
          // Notify the customer page about the new link (using BroadcastChannel)
          const broadcast = new BroadcastChannel('newLink');
          broadcast.postMessage(newLink);

          linkInput.value = '';
          linkInput.style.display = 'none';
        })
        .catch(error => console.error("Error adding link:", error));
    }

    function doneAdding() {
      // Redirect back to the editor's homepage
      window.location.href = "editor.html";
      // This line is crucial for updating the display after redirecting
      setTimeout(fetchLinks, 0); // Fetch and display links after a short delay
    }
  </script>
</body>
</html>