<!DOCTYPE html>
<html>
<head>
  <title>Editor</title>
  <style>
    #link-input { display: none; }
    .pink-container { background-color: pink; padding: 10px; margin: 5px; display: inline-block; cursor: pointer; }
    #done-button { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Editor</h2>
    <input type="text" id="link-input" placeholder="Paste Google Drive link">
    <button onclick="showInput()">Add Link</button>
    <div id="links-display"></div>
    <button id="done-button" onclick="doneAdding()">Done</button>
  </div>

  <script>
    const linkInput = document.getElementById('link-input');
    const linksDisplay = document.getElementById('links-display');
    const doneButton = document.getElementById('done-button');
    let links = [];

    window.addEventListener('DOMContentLoaded', fetchLinks);

    function fetchLinks() {
      fetch('/data.json')
        .then(res => res.json())
        .then(data => { links = data; displayLinks(); });
    }

    function displayLinks() {
      linksDisplay.innerHTML = '';
      links.forEach(linkObj => {
        const linkContainer = document.createElement('div');
        linkContainer.className = 'pink-container';
        linkContainer.textContent = linkObj.link;
        linksDisplay.appendChild(linkContainer);
      });
      doneButton.style.display = links.length > 0 ? 'block' : 'none';
    }

    function showInput() { linkInput.style.display = 'block'; }

    function addLink() {
      const link = linkInput.value;
      fetch('/.netlify/functions/update-links', {
        method: 'POST',
        body: JSON.stringify({ link })
      })
        .then(res => res.json())
        .then(newLink => {
          links.push(newLink);
          displayLinks();
          new BroadcastChannel('newLink').postMessage(newLink);
          linkInput.value = '';
          linkInput.style.display = 'none';
        })
        .catch(err => console.error("Add Link Error:", err));
    }

    function doneAdding() { fetchLinks(); }
  </script>
</body>
</html>